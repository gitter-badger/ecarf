{
    "id":"ecarf-assemble-dictionary-job",
    "description":"Assemble the ECARF terms dictionary",
    "mode":"Serial",
    "data":{
        "bucket":"swetodblp-term-2part--1",
        "jobId": "run-1",
        "outBucket":"swetodblp-dictionary"
    },
    "vmConfig":{
        "zoneId":"us-central1-a",
        "imageId":"ecarf-1000/global/images/ecarf-centos-6-v20160126-2",
        "vmType":"n1-standard-2",
        "cost":0.126,
        "minUsage":600,
        "networkId":"default",
        "diskType":"pd-standard",
        "startupScript":"su - omerio -c 'cd /home/omerio/ecarf && git pull && /home/omerio/maven/bin/mvn -q clean compile install -Dmaven.test.skip=true && cd /home/omerio/ecarf/ecarf-evm && export VM_XMS=\"-Xms1g\" VM_XMX=\"-Xmx6g\" && mvn -q exec:exec 2>&1 & exit 0' exit 0"
    },
    "tasks":[
        {
            "id":"start-processors-task",
            "description":"A dummy task to start all the processors before hand",
            "className":"io.ecarf.core.cloud.task.processor.DummyProcessorTask",
            "target":"PROCESSOR",
            "partitioning":{
                "type":"COUNT",
                "count":1
            },
            "errorAction":"EXIT"
        },
        {
            "id":"assemble-dictionary-task",
            "description":"Assemble the terms dictionary",
            "className":"io.ecarf.core.cloud.task.processor.dictionary.AssembleDictionaryTask",
            "target":"PROCESSOR",
            "input":{
                "bucket":"#bucket",
                "targetBucket":"#outBucket"
            },
            "partitioning":{
                "type":"COUNT",
                "count":1
            },
            "errorAction":"EXIT"
        },
        {
            "id":"processor-do-upload-logs-task",
            "description":"Distribute the uploading of logs task between the various processors, each processor then uploads its own logs to cloud storage",
            "className":"io.ecarf.core.cloud.task.common.DoUploadOutputLogTask",
            "target":"PROCESSOR",
            "input":{
                "bucket":"#outBucket",
                "jobId":"#jobId"
            },
            "partitioning":{
                "type":"ITEMS",
                "input":{
                    "items":"#processors"
                }
            },
            "errorAction":"EXIT"
        },
        {
            "id":"coordinator-do-upload-logs-task",
            "description":"The coordinator to upload its own logs to cloud storage",
            "className":"io.ecarf.core.cloud.task.common.DoUploadOutputLogTask",
            "target":"COORDINATOR",
            "input":{
                "bucket":"#outBucket",
                "jobId":"#jobId"
            },
            "errorAction":"EXIT"
        }
    ]
}